# 不規則周期変調を用いた数理最適化による広帯域化

本研究では、数理最適化を行った。

L-BFGS法のような勾配法を適用するためには、目的関数がパラメータに対して滑らか（微分可能）であることが必須となる。そのため、本研究では各ドメイン幅を連続変数として扱った。

また、目的関数には、所望の帯域内におけるスペクトル強度と、理想とする平坦なターゲット形状との平均二乗誤差（MSE）を採用した。例えば95%帯域幅そのものを直接最大化しようとすると、その算出過程に閾値判定などの微分不可能な操作が含まれるため、自動微分による勾配計算ができず、最適化が機能しない。対してMSEを指標とすることで、関数の滑らかさが保たれ、高速かつ安定した収束が可能となる。

しかし、QPM構造の最適化においては、「どの程度の帯域幅でどの程度の変換効率が実現可能か」という制約が自明ではない。物理的な限界を超えた過剰な要求は最適化計算の破綻を招く一方で、確実な収束を求めて要求水準を下げれば、本来得られるはずの性能を犠牲にすることになる。すなわち、最適な「ターゲット形状（帯域幅と平坦部強度）」自体が未知であるという問題がある。

この問題に対処するため、本研究では、「目指すべきスペクトル形状の提案」をメタヒューリスティクス的に行い、「目的形状への数理最適化」を決定論的に行う二段階の最適化ループを実施した。

## メタヒューリスティクス的ベイズ最適化

外側のループでは、決定論的最適化（L-BFGS）に与える「ターゲット形状」のハイパーパラメータ探索を行う。ここで、ターゲット帯域の中心は固定値とし、「帯域幅」と「平坦部の強度」の2つをハイパーパラメータとした。

評価関数には、内部ループによる構造最適化後のスペクトル形状を用いて、以下の指標の最大化を目指した。

$$
Score = \text{Detected FW95} \times \text{Peak Intensity}
$$

ここで、FW95は最大強度の95%以上の領域幅を指す。このスコア設定により、帯域幅と強度のトレードオフにおけるパレート最適解付近を探索させた。

## 決定論的L-BFGS

内側のループでは、ベイズ最適化によって提案されたターゲット形状に対し、実際のスペクトル形状を合致させるための構造最適化を行う。

分極反転領域の総数（ドメイン数）は固定したまま、その全てのドメイン幅を連続変数として扱い、JAXと自動微分を用いたL-BFGSアルゴリズムで構造最適化を行った。

損失関数には、ターゲット帯域内における計算されたスペクトル強度と、設定した目標強度との間の平均二乗誤差（MSE）を採用した。

## 最適化結果

最終的に得られた構造では、従来手法である3セグメント構造と比較して約2.6倍の帯域幅を持ちながら、規格化変換効率においても元の65%という高い値を維持することに成功した。

<!-- 結果の図 -->
