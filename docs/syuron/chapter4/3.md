## 有効結合係数

結合波方程式における非線形相互作用項は、結合係数 $\kappa(z)$ と位相不整合 $\Delta k$ の積として、空間的に激しく振動する。ステップ幅 $h$ の区間 $[z_n, z_{n+1}]$ において、振幅 $\boldsymbol{A}$ の変化が緩やかであると仮定し、急速に変化する位相項のみを先行して積分した量を「有効結合係数」$\tilde{\kappa}(\Delta k)$ として定義する。

$$
\tilde{\kappa}(\Delta k) = \int_{z_n}^{z_{n+1}} \kappa(z) e^{i\Delta k z} dz
$$

この係数は、区間内での分極反転構造（$\kappa(z)$ の符号変化）と位相回転（$e^{i\Delta k z}$）の相関を正確に取り込んだ複素スカラー量となる。

## 基本的な数値解法

この有効結合係数を用いると、結合波方程式の最も単純な積分形（オイラー法に相当）は、以下のような代数演算のみで記述できる。

$$
A_1(z_{n+1}) = A_1(z_n) + i \left[ A_2 A_1^* \tilde{\kappa}_{\text{SHG}}(\Delta k_{\text{SHG}}) + A_3 A_2^* \tilde{\kappa}_{\text{SFG}}(\Delta k_{\text{SFG}}) \right] \\ A_2(z_{n+1}) = A_2(z_n) + i \left[ A_1^2 \tilde{\kappa}_{\text{SHG}}(-\Delta k_{\text{SHG}}) + 2 A_3 A_1^* \tilde{\kappa}_{\text{SFG}}(\Delta k_{\text{SFG}}) \right] \\ A_3(z_{n+1}) = A_3(z_n) + i \left[ 3 A_1 A_2 \tilde{\kappa}_{\text{SFG}}(-\Delta k_{\text{SFG}}) \right]
$$

ここで、右辺の振幅 $A_j$ は $z_n$ での値を用いる。$\tilde{\kappa}(-\Delta k) = \tilde{\kappa}(\Delta k)^*$ であることに注意すれば、計算に必要な係数はステップごとに事前に確定する。この手法は極めて高速であるが、ユニタリ性が保証されないため、長距離伝搬ではエネルギー誤差が蓄積する可能性がある。

## Magnus-Cayleyスキーム

エネルギー保存則（Manley-Rowe関係式）を厳密に満たすためには、時間発展演算子がユニタリ行列でなければならない。そこで、中点予測（Midpoint Predictor）とMagnus展開を組み合わせ、Cayley変換によりユニタリ性を担保するスキームを導入する。

まず、前述の基本解法を用いて、区間の中点 $z_{n+1/2}$ における振幅 $\boldsymbol{A}_{n+1/2}$ を予測する。次に、結合波方程式の非線形項を線形形式 $\frac{d\boldsymbol{A}}{dz} = \mathbf{M}(z; \boldsymbol{A}) \boldsymbol{A}$ に変形し、区間全体での時間発展演算子をMagnus展開により求める。

ここで、エネルギー保存則（Manley-Rowe関係式：$\frac{d}{dz}\sum |A_j|^2 = 0$）を満たすユニタリ更新を可能にするため、係数行列 $\mathbf{M}$ が歪エルミート性（$\mathbf{M}^\dagger = -\mathbf{M}$）を持つように非線形項を分配する。具体的には、$A_3$ に関する式中の項 $3\kappa_{\text{SFG}}A_1 A_2$ を $1 \cdot (\dots) + 2 \cdot (\dots)$ に分割し、反対称成分として $A_1$ と $A_2$ の発展方程式における係数に対応させる。これにより、有効結合行列 $\mathbf{M}$ は以下のように構成される（Skew-Hamiltonian construction）。

$$
\mathbf{M}(z; \boldsymbol{A}) = i \begin{pmatrix} 0 & \kappa_{\text{SHG}} e^{i\Delta k_{\text{SHG}} z} A_1^* & \kappa_{\text{SFG}} e^{i\Delta k_{\text{SFG}} z} A_2^* \\ \kappa_{\text{SHG}} e^{-i\Delta k_{\text{SHG}} z} A_1 & 0 & 2 \kappa_{\text{SFG}} e^{i\Delta k_{\text{SFG}} z} A_1^* \\ \kappa_{\text{SFG}} e^{-i\Delta k_{\text{SFG}} z} A_2 & 2 \kappa_{\text{SFG}} e^{-i\Delta k_{\text{SFG}} z} A_1 & 0 \\ \end{pmatrix}
$$

Magnus展開の第1次項 $\mathbf{\Omega}_1$ は、この行列 $\mathbf{M}$ の積分で与えられる。積分計算において振幅 $\boldsymbol{A}$ を中点予測値 $\boldsymbol{A}_{n+1/2}$ に固定すると、各要素は有効結合係数 $\tilde{\kappa}$ を用いて表現される。

$$
\mathbf{\Omega}_{n+1/2} = \int_{z_n}^{z_{n+1}} \mathbf{M}(z; \boldsymbol{A}_{n+1/2}) dz = i \begin{pmatrix} 0 & \mu_{12} & \mu_{13} \\ \mu_{12}^* & 0 & \mu_{23} \\ \mu_{13}^* & \mu_{23}^* & 0 \\ \end{pmatrix}
$$

この行列の各要素 $\mu_{ij}$ は、有効結合係数と中点での振幅を用いて以下のように与えられる。

$$
\mu_{12} = \tilde{\kappa}_{\mathrm{SHG}}(\Delta k_{\mathrm{SHG}}) \cdot A_{1, n+1/2}^* \\ \mu_{13} = \tilde{\kappa}_{\mathrm{SFG}}(\Delta k_{\mathrm{SFG}}) \cdot A_{2, n+1/2}^* \\ \mu_{23} = 2 \cdot \tilde{\kappa}_{\mathrm{SFG}}(\Delta k_{\mathrm{SFG}}) \cdot A_{1, n+1/2}^*
$$

第1行第2列の要素 $\mu_{12}$ がSHG過程、$\mu_{13}$ がSFG過程に対応し、$\mu_{23}$ はSFG過程における第2高調波の寄与（係数2）を含んでいる。
最終的に、Cayley変換を用いて次のステップの振幅 $\boldsymbol{A}_{n+1}$ を求める。

$$
\boldsymbol{A}_{n+1} = \left( \mathbf{I} - \frac{1}{2}\mathbf{\Omega}_{n+1/2} \right)^{-1} \left( \mathbf{I} + \frac{1}{2}\mathbf{\Omega}_{n+1/2} \right) \boldsymbol{A}_n
$$

この更新式は常にManley-Rowe関係式を厳密に保存し、かつ有効結合係数によって構造の微細な周期性を正しく反映するため、大きなステップサイズでも安定かつ高精度な解を得ることができる。
